<div id="dashboard-container" class="col-lg-12">
  <div id="purchases">
      <h2>Productos contratados</h2>
      <% if not current_user.purchases_combos.empty? %>
          <% current_user.purchases_combos.each do |pc| %>
            <div class="purchase">
              <div class="purchase-account col-lg-3">
                <img src="<%= pc.combo.product.image %>" alt="<%= pc.combo.product.name %>">
                <h4 class="product-name"><%= pc.combo.product.name %></h4>
                  <p><strong>Usuario:</strong> <%= pc.user_name %></p>
                  <p><strong>Password:</strong> <%= pc.password %></p>
                  <h2 class="total-price">$1,449.00</h2>
              </div>
              <div class="purchase-detail col-lg-9">
                <h4>Paquetes comprados</h4>
                <% Combo.all.each do |combo| %>
                    <% if combo == pc.combo %>
                        <h3><%= combo.name %></h3>
                        <p><strong><%= number_to_currency(combo.price,precision: 2, locale: :en)%></strong></p>
                        <% purchasable_addons = combo.addons_combos.where("purchasable = ?", true) %>
                        <% if not purchasable_addons.empty? %>
                            <% subtotal = 0 %>
                            <p>Adicionales</p>
                            <% purchasable_addons.each do |addon_combo| %>
                                <div><p><%= addon_combo.addon.name %> <%= addon_combo.quantity %> <%= "$#{addon_combo.price}" %>
                                  <% nuevo_addon = true %>
                                  <% if not current_user.purchases_addons.empty? %>
                                      <% current_user.purchases_addons.each do |pa| %>
                                          <% if pa.addon == addon_combo.addon and combo == pc.combo %>
                                              <% nuevo_addon = false %>
                                              <% subtotal += pa.total_price %>
                                              - <strong><%= pa.quantity %> Addon(s) comprado(s)</strong> -
                                          <% end %>
                                      <% end %>
                                  <% end %>
                                  </div>
                            <% end %>

                                <div>Total mensual: <%= pc.total_price + subtotal %></div>

                        <% end %>
                    <% end %>
                <% end %>
              </div>
              <div class="clearfix"></div>
            </div>
          <% end %>
      <% else %>
          <div class="panel panel-default">
            <!-- Default panel contents -->
            <div class="panel-heading">Lo sentimos...</div>
            <div class="panel-body">
              <p>
                Parece que actualmente no tienes productos contratados. Haz clic <a href="#products">aquí</a> si deseas ver la lista de
                los artículos disponibles para tí. Si tienes alguna duda, contacta a un asesor desde nuestro <a href="#chat">chat</a>.
            </div>
          </div>
      <% end %>
  </div>

  <h2>Tienda</h2>
    <div id="carousel-example-generic-dashboard" class="carousel slide" data-ride="carousel">
      <ol class="carousel-indicators">
        <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
        <li data-target="#carousel-example-generic" data-slide-to="1"></li>
        <li data-target="#carousel-example-generic" data-slide-to="2"></li>
      </ol>
      <!-- Wrapper for slides -->
      <div class="carousel-inner">
        <div class="item active">
          <img src="/assets/mediaimac.png" alt="Media">
        </div>
        <div class="item">
          <img src="/assets/mediaimac.png" alt="Media">
        </div>
      </div>

      <!-- Controls -->
      <a class="left carousel-control" href="#carousel-example-generic" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left"></span>
      </a>
      <a class="right carousel-control" href="#carousel-example-generic" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right"></span>
      </a>
    </div>
    <h2>Productos</h2>
    <ul id="products" class="row">
      <% if @products.count() > 0 then %>
          <% @products.each do |product| %>
              <li class="col-lg-4 col-med-2 col-sm-12">
                <a href="product-detail/<%= product.id %>">
                  <img src="<%= product.image %>" alt="<%= product.name %>">
                  <%= product.name %>
                </a>
                <div class="clearfix"></div>
              </li>
          <% end %>
      <% end %>
    </ul>

    <div id="chat">
        <h2>Servicio al Cliente</h2>
        <div class="avatar col-md-2">
          <div class="inner-avatar">
            <img src="/assets/team/carmen.png">
          </div>
        </div>
        <div class="chat-info col-md-10">
          <p>
            Conoce a tu agente de servicio <br>
            <strong>Abril Fernádez</strong>
          </p>
          <button class="btn btn-a btn-small btn-blue">Chatea ahora</button>
        </div>
        <div class="clearfix"></div>
    </div>

</div>
